{% extends "template.html" %}


{% block "content" %}

<h3>Events</h3>

<div class="col-lg-12">
    <div class="card">
        <div class="card-body">

            <h4>Event query
                <small>(must be of the same type)</small>
            </h4>

            <div class="panel panel-default">
                <div class="panel-heading" style="padding: 10px;">
                    Example query
                </div>
                <div class="panel-body">
                    <p>Example query for events from the last 24h from the event category
                        Category1:</p>
                    <code>select "Category1" >= 24h</code>

                    <p>Example query for events from the last 15 minutes from the event category
                        events_category_01:</p>
                    <code>select "events_category_01" >= 15m</code> (note that 15m means 15 minutes, 24h means 24 hours)
                </div>
            </div>
            <div class="form-group">
                <label for="query" class="control-label">Query</label>

                <div class="input-group">
                    <input type="text" class="form-control" id="query" style="font-family: consolas;">

                    <div class="input-group-btn">
                        <button class="btn btn-success" id="run-query">Run query</button>
                    </div>
                </div>
            </div>

            <div class="alert alert-danger" id="query-error" hidden>An error occured: <span id="query-error-msg"></span>
            </div>

            <div id="table-area"></div>

        </div>
    </div>
</div>

<script>
    $("#run-query").on('click', function (event) {
        event.preventDefault();

        $("#table-area").empty();
        $("#query-error").hide();

        pymicroserviceMethodCall({
            method: 'query_events',
            params: {
                query: $("#query").val()
            },
            onSuccess: function (data) {
                if (data.error) {
                    $("#query-error").show();
                    $("#query-error-msg").text(JSON.stringify(data.error));
                }
                else {
                    console.log(data.result);
                    $("#table-area").append($("<table id='data-table' class='table'></table>"));

                    $("#data-table").dataTable({
                        data: data.result,
                        columns: [
                            {data: 'values', title: 'values'},
                            {data: 'source', title: 'source'},
                            {data: 'timestamp', title: 'timestamp'}
                        ]
                    })
                }
            }
        })

    })
</script>

{% end %}

